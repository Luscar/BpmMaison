graph TD
    Start([Gestion ComplÃ¨te de Commande Client])
    Start --> recevoir-commande

    recevoir-commande[âš™ï¸ RÃ©ception de la Commande]
    class recevoir-commande businessStep
    recevoir-commande --> valider-inventaire

    valider-inventaire{â“ VÃ©rifier DisponibilitÃ© Produits}
    class valider-inventaire decisionStep
    valider-inventaire -->|disponibilite == 'complet'| produits-disponibles
    valider-inventaire -->|disponibilite == 'partiel'| disponibilite-partielle
    valider-inventaire -->|disponibilite == 'aucun'| produits-indisponibles

    produits-disponibles[âš™ï¸ Calculer Prix et Taxes]
    class produits-disponibles businessStep
    produits-disponibles --> verifier-montant

    disponibilite-partielle(ðŸ‘¤ Contacter Client - Partiel)
    class disponibilite-partielle interactiveStep
    disponibilite-partielle --> attendre-reponse-client

    attendre-reponse-client([ðŸ“¡ Attente RÃ©ponse (48h)])
    class attendre-reponse-client signalStep
    attendre-reponse-client --> traiter-reponse

    traiter-reponse{â“ Traiter DÃ©cision Client}
    class traiter-reponse decisionStep
    traiter-reponse -->|decision == 'accepter-partiel'| produits-disponibles
    traiter-reponse -->|decision == 'annuler'| annuler-commande
    traiter-reponse -->|decision == 'attendre'| attendre-disponibilite

    attendre-disponibilite([ðŸ“¡ Attendre RÃ©approvisionnement])
    class attendre-disponibilite signalStep
    attendre-disponibilite --> produits-disponibles

    produits-indisponibles[âš™ï¸ Notifier Client - Indisponible]
    class produits-indisponibles businessStep
    produits-indisponibles --> annuler-commande

    verifier-montant{â“ VÃ©rification du Montant}
    class verifier-montant decisionStep
    verifier-montant -->|montantTotal < 500| traiter-directement
    verifier-montant -->|montantTotal >= 500 && mont...| approbation-superviseur
    verifier-montant -->|montantTotal >= 5000| approbation-directeur

    traiter-directement[âš™ï¸ Traitement Automatique]
    class traiter-directement businessStep
    traiter-directement --> verifier-client

    approbation-superviseur(ðŸ‘¤ Approbation Superviseur)
    class approbation-superviseur interactiveStep
    approbation-superviseur --> verifier-client

    approbation-directeur(ðŸ‘¤ Approbation Directeur)
    class approbation-directeur interactiveStep
    approbation-directeur --> validation-finance

    validation-finance(ðŸ‘¤ Validation DÃ©partement Finance)
    class validation-finance interactiveStep
    validation-finance --> verifier-client

    verifier-client{â“ VÃ©rification CrÃ©dit Client}
    class verifier-client decisionStep
    verifier-client -->|creditOk == true| processus-paiement
    verifier-client -->|creditOk == false| demander-paiement-avance

    demander-paiement-avance[âš™ï¸ Demander Paiement AnticipÃ©]
    class demander-paiement-avance businessStep
    demander-paiement-avance --> attendre-paiement-avance

    attendre-paiement-avance([ðŸ“¡ Attente Paiement (7 jours)])
    class attendre-paiement-avance signalStep
    attendre-paiement-avance --> processus-paiement

    processus-paiement[[ðŸ“¦ Traitement du Paiement]]
    class processus-paiement subProcessStep
    processus-paiement --> verifier-paiement

    verifier-paiement{â“ VÃ©rifier Statut Paiement}
    class verifier-paiement decisionStep
    verifier-paiement -->|paiementStatut == 'succes'| preparer-commande
    verifier-paiement -->|paiementStatut == 'echoue'| gestion-paiement-echoue
    verifier-paiement -->|paiementStatut == 'pending'| attendre-paiement-pending

    attendre-paiement-pending([â° Attendre Confirmation Paiement])
    class attendre-paiement-pending scheduledStep
    attendre-paiement-pending --> verifier-paiement

    gestion-paiement-echoue(ðŸ‘¤ GÃ©rer Ã‰chec de Paiement)
    class gestion-paiement-echoue interactiveStep
    gestion-paiement-echoue --> annuler-commande

    preparer-commande[âš™ï¸ PrÃ©paration Commande EntrepÃ´t]
    class preparer-commande businessStep
    preparer-commande --> assigner-preparation

    assigner-preparation(ðŸ‘¤ Assigner PrÃ©parateur)
    class assigner-preparation interactiveStep
    assigner-preparation --> attendre-preparation

    attendre-preparation([ðŸ“¡ Attendre Fin PrÃ©paration])
    class attendre-preparation signalStep
    attendre-preparation --> controler-qualite

    controler-qualite(ðŸ‘¤ ContrÃ´le QualitÃ©)
    class controler-qualite interactiveStep
    controler-qualite --> verifier-qualite

    verifier-qualite{â“ VÃ©rifier RÃ©sultat QualitÃ©}
    class verifier-qualite decisionStep
    verifier-qualite -->|qualiteOk == true| planifier-livraison
    verifier-qualite -->|qualiteOk == false && repre...| repreparation
    verifier-qualite -->|qualiteOk == false && repre...| annuler-commande

    repreparation[âš™ï¸ ReprÃ©paration Requise]
    class repreparation businessStep
    repreparation --> assigner-preparation

    planifier-livraison[âš™ï¸ Planification Livraison]
    class planifier-livraison businessStep
    planifier-livraison --> verifier-mode-livraison

    verifier-mode-livraison{â“ DÃ©terminer Mode Livraison}
    class verifier-mode-livraison decisionStep
    verifier-mode-livraison -->|modeLivraison == 'express'| livraison-express
    verifier-mode-livraison -->|modeLivraison == 'standard'| livraison-standard
    verifier-mode-livraison -->|modeLivraison == 'economique'| livraison-economique

    livraison-express[[ðŸ“¦ Traitement Livraison Express]]
    class livraison-express subProcessStep
    livraison-express --> confirmer-expedition

    livraison-standard[âš™ï¸ Traitement Livraison Standard]
    class livraison-standard businessStep
    livraison-standard --> attendre-ramassage

    attendre-ramassage([â° Attendre Ramassage Transporteur])
    class attendre-ramassage scheduledStep
    attendre-ramassage --> confirmer-expedition

    livraison-economique[âš™ï¸ Traitement Livraison Ã‰conomique]
    class livraison-economique businessStep
    livraison-economique --> attendre-consolidation

    attendre-consolidation([â° Attendre Consolidation Envois])
    class attendre-consolidation scheduledStep
    attendre-consolidation --> confirmer-expedition

    confirmer-expedition[âš™ï¸ Confirmer ExpÃ©dition]
    class confirmer-expedition businessStep
    confirmer-expedition --> notifier-client-expedition

    notifier-client-expedition[âš™ï¸ Notifier Client de l'ExpÃ©dition]
    class notifier-client-expedition businessStep
    notifier-client-expedition --> attendre-livraison

    attendre-livraison([ðŸ“¡ Attendre Confirmation Livraison])
    class attendre-livraison signalStep
    attendre-livraison --> verifier-livraison

    verifier-livraison{â“ VÃ©rifier Statut Livraison}
    class verifier-livraison decisionStep
    verifier-livraison -->|livraisonStatut == 'livree'| cloturer-commande
    verifier-livraison -->|livraisonStatut == 'probleme'| gerer-probleme-livraison
    verifier-livraison -->|livraisonStatut == 'en-cours'| attendre-livraison

    gerer-probleme-livraison(ðŸ‘¤ GÃ©rer ProblÃ¨me de Livraison)
    class gerer-probleme-livraison interactiveStep
    gerer-probleme-livraison --> attendre-resolution

    attendre-resolution([ðŸ“¡ Attendre RÃ©solution])
    class attendre-resolution signalStep
    attendre-resolution --> cloturer-commande

    cloturer-commande[âš™ï¸ ClÃ´turer la Commande]
    class cloturer-commande businessStep
    cloturer-commande --> envoyer-sondage

    envoyer-sondage[âš™ï¸ Envoyer Sondage Satisfaction]
    class envoyer-sondage businessStep
    envoyer-sondage --> attendre-sondage

    attendre-sondage([â° Attendre RÃ©ponse Sondage (7j)])
    class attendre-sondage scheduledStep
    attendre-sondage --> archiver-commande

    archiver-commande[âš™ï¸ Archiver la Commande]
    class archiver-commande businessStep
    archiver-commande --> End([Fin])

    annuler-commande[âš™ï¸ Annulation de la Commande]
    class annuler-commande businessStep
    annuler-commande --> notifier-annulation

    notifier-annulation[âš™ï¸ Notifier Client Annulation]
    class notifier-annulation businessStep
    notifier-annulation --> archiver-commande

    classDef businessStep fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef interactiveStep fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef decisionStep fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    classDef scheduledStep fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef signalStep fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef subProcessStep fill:#e0f2f1,stroke:#004d40,stroke-width:2px